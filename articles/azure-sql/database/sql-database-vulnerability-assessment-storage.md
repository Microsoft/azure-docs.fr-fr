---
title: Stocker les résultats de l’analyse Évaluation des vulnérabilités dans un compte de stockage accessible derrière des pare-feu et réseaux virtuels
description: Fournit des instructions sur le stockage des analyses Évaluation des vulnérabilités dans un compte de stockage accessible via un pare-feu ou un réseau virtuel
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.topic: how-to
author: barmichal
ms.author: mibar
ms.reviewer: vanto
ms.date: 12/01/2020
ms.openlocfilehash: d6f42df0858042f569b459c43a80ce6b062cee9f
ms.sourcegitcommit: 6a350f39e2f04500ecb7235f5d88682eb4910ae8
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/01/2020
ms.locfileid: "96454076"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>Stocker les résultats de l’analyse Évaluation des vulnérabilités dans un compte de stockage accessible derrière des pare-feu et réseaux virtuels
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

Si vous limitez l’accès à votre compte de stockage dans Azure pour certains réseaux virtuels ou services, vous devez activer la configuration appropriée pour que l’analyse Évaluation des vulnérabilités des instances SQL Database ou Managed Instance ait accès à ce compte de stockage.

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>Activer l’accès de l’analyse Évaluation des vulnérabilités d’Azure SQL Database au compte de stockage

Si vous avez configuré votre compte de stockage Évaluation des vulnérabilités de façon à ce qu’il soit accessible uniquement par certains réseaux ou services, vous devez vous assurer que les analyses Évaluation des vulnérabilités de votre Azure SQL Database sont en mesure de stocker les résultats sur le compte de stockage. Pour savoir quel est le compte de stockage utilisé, accédez au volet **SQL Server** dans le [portail Azure](https://portal.azure.com) et, sous **Sécurité**, sélectionnez **Security Center**.

:::image type="content" source="../database/media/azure-defender-for-sql/va-storage.png" alt-text="configurer l’évaluation des vulnérabilités":::

Vous pouvez utiliser le compte de stockage existant ou en créer un pour stocker les résultats de l’analyse Évaluation des vulnérabilités pour toutes les bases de données de votre [serveur SQL logique](logical-servers.md).

Accédez à votre **groupe de ressources** qui contient le compte de stockage, puis au volet **Compte de stockage**. Sous **Paramètres**, sélectionnez **Pare-feu et réseaux virtuels**.

Vérifiez que l’option **Autoriser les services Microsoft approuvés à accéder à ce compte de stockage** est cochée.

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="La capture d’écran montre la boîte de dialogue Pare-feux et réseaux virtuels, avec l’option Autoriser les services Microsoft approuvés à accéder à ce compte de stockage sélectionnée.":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>Stocker les résultats de l’analyse Évaluation des vulnérabilités pour Azure SQL Managed Instance dans un compte de stockage accessible derrière un pare-feu ou un réseau virtuel

Étant donné que Managed Instance n’est pas un service Microsoft approuvé et qu’il possède un réseau virtuel différent de celui du compte de stockage, l’exécution d’une analyse Évaluation des vulnérabilités génère une erreur.

Pour prendre en charge les analyses Évaluation des vulnérabilités sur les Managed Instances, suivez les étapes ci-dessous :

1. Dans le volet **Instance gérée SQL**, sous le titre **Vue d’ensemble**, cliquez sur le lien **Réseau virtuel/sous-réseau**. Vous accédez ainsi au volet **Réseau virtuel**.

   :::image type="content" source="../managed-instance/media/public-endpoint-configure/mi-overview.png" alt-text="mi-vue-d-ensemble2":::

1. Sous **Paramètres**, sélectionnez **Sous-réseaux**. Cliquez sur **Sous-réseau** dans le nouveau volet pour ajouter un sous-réseau, puis déléguez-le à *Microsoft.sql\managedInstance*. Pour plus d’informations, consultez [Gérer les sous-réseaux](../../virtual-network/virtual-network-manage-subnet.md).

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="La capture d’écran montre un sous-réseau qui a été délégué à Microsoft.sql\managedInstance.":::

1. Dans le volet **Réseau virtuel**, sous **Paramètres**, sélectionnez **Points de terminaison de service**. Cliquez sur **Ajouter** dans le nouveau volet, puis ajoutez le service *Microsoft.Storage* en tant que nouveau point de terminaison de service. Assurez-vous que le sous-réseau *ManagedInstance* est sélectionné. Cliquez sur **Add**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="La capture d’écran montre la fenêtre Ajouter des points de terminaison de service, dans laquelle vous ajoutez le service Microsoft.Storage en tant que point de terminaison.":::

1. Accédez au **compte de stockage** que vous avez sélectionné pour stocker vos analyses Évaluation des vulnérabilités. Sous **Paramètres**, sélectionnez **Pare-feu et réseaux virtuels**. Cliquez sur **Ajouter un réseau virtuel existant**. Sélectionnez le réseau virtuel et le sous-réseau de votre instance gérée, puis cliquez sur **Ajouter**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="La capture d’écran montre le volet Pare-feux et réseaux virtuels, qui contient le lien Ajouter un réseau virtuel existant.":::

Vous devez maintenant être en mesure de stocker vos analyses Évaluation des vulnérabilités pour les Managed Instances dans votre compte de stockage.

## <a name="next-steps"></a>Étapes suivantes

- [Évaluation des vulnérabilités](sql-vulnerability-assessment.md)
- [Création d’un compte de stockage Azure](../../storage/common/storage-account-create.md)
- [Azure Defender pour SQL](azure-defender-for-sql.md)